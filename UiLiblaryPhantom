-- Phantom Spy UI Library v2.0
-- Universal UI System for PC & Mobile
-- By CoolExploit

local UILib = {}
UILib.__index = UILib

-- Services
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")

-- Configuration
local CONFIG = {
    MOBILE_THRESHOLD = 600,
    TWEEN_DURATION = 0.3,
    TOUCH_TARGET_SIZE = 44,
    DESKTOP_PADDING = 10,
    MOBILE_PADDING = 15,
    ANIMATION_SPRING = 0.5
}

-- Theme System
UILib.Themes = {
    Dark = {
        Background = Color3.fromRGB(30, 30, 40),
        Secondary = Color3.fromRGB(45, 45, 55),
        Accent = Color3.fromRGB(0, 170, 255),
        Text = Color3.fromRGB(255, 255, 255),
        SubText = Color3.fromRGB(200, 200, 200),
        Success = Color3.fromRGB(85, 170, 85),
        Warning = Color3.fromRGB(255, 170, 0),
        Error = Color3.fromRGB(255, 85, 85),
        Border = Color3.fromRGB(60, 60, 70)
    },
    Light = {
        Background = Color3.fromRGB(245, 245, 245),
        Secondary = Color3.fromRGB(225, 225, 235),
        Accent = Color3.fromRGB(0, 120, 215),
        Text = Color3.fromRGB(30, 30, 30),
        SubText = Color3.fromRGB(100, 100, 100),
        Success = Color3.fromRGB(65, 150, 65),
        Warning = Color3.fromRGB(200, 120, 0),
        Error = Color3.fromRGB(200, 60, 60),
        Border = Color3.fromRGB(200, 200, 210)
    }
}

UILib.CurrentTheme = UILib.Themes.Dark
UILib.Windows = {}
UILib.IsMobile = UserInputService.TouchEnabled
UILib.Components = {}

-- Core UI Creation Functions
function UILib:CreateScreenGui(name, parent)
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = name or "UILibGui"
    screenGui.ResetOnSpawn = false
    screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    screenGui.DisplayOrder = 999
    screenGui.Parent = parent or game:GetService("CoreGui") or Players.LocalPlayer:WaitForChild("PlayerGui")
    
    return screenGui
end

function UILib:CreateWindow(name, size, position, theme)
    local screenGui = self:CreateScreenGui(name .. "Gui")
    
    local isMobile = self.IsMobile
    local baseSize = size or (isMobile and UDim2.new(0.9, 0, 0.8, 0) or UDim2.new(0, 500, 0, 600))
    local basePosition = position or (isMobile and UDim2.new(0.05, 0, 0.1, 0) or UDim2.new(0, 50, 0, 50))
    
    if theme then
        self.CurrentTheme = self.Themes[theme] or self.Themes.Dark
    end

    local mainFrame = Instance.new("Frame")
    mainFrame.Name = name .. "Window"
    mainFrame.Size = baseSize
    mainFrame.Position = basePosition
    mainFrame.BackgroundColor3 = self.CurrentTheme.Background
    mainFrame.BorderSizePixel = 0
    mainFrame.ClipsDescendants = true
    mainFrame.Parent = screenGui

    local uiCorner = Instance.new("UICorner")
    uiCorner.CornerRadius = UDim.new(0, isMobile and 12 or 8)
    uiCorner.Parent = mainFrame

    local dropShadow = Instance.new("ImageLabel")
    dropShadow.Name = "DropShadow"
    dropShadow.Size = UDim2.new(1, 12, 1, 12)
    dropShadow.Position = UDim2.new(0, -6, 0, -6)
    dropShadow.BackgroundTransparency = 1
    dropShadow.Image = "rbxassetid://6014261993"
    dropShadow.ImageColor3 = Color3.new(0, 0, 0)
    dropShadow.ImageTransparency = 0.8
    dropShadow.ScaleType = Enum.ScaleType.Slice
    dropShadow.SliceCenter = Rect.new(49, 49, 450, 450)
    dropShadow.Parent = mainFrame

    local header = Instance.new("Frame")
    header.Name = "Header"
    header.Size = UDim2.new(1, 0, 0, isMobile and 50 or 40)
    header.BackgroundColor3 = self.CurrentTheme.Secondary
    header.BorderSizePixel = 0
    header.Parent = mainFrame

    local headerCorner = Instance.new("UICorner")
    headerCorner.CornerRadius = UDim.new(0, isMobile and 12 or 8)
    headerCorner.Parent = header

    local title = Instance.new("TextLabel")
    title.Name = "Title"
    title.Size = UDim2.new(0.7, 0, 1, 0)
    title.Position = UDim2.new(0.02, 0, 0, 0)
    title.BackgroundTransparency = 1
    title.Text = name
    title.TextColor3 = self.CurrentTheme.Text
    title.TextSize = isMobile and 20 or 18
    title.Font = Enum.Font.GothamBold
    title.TextXAlignment = Enum.TextXAlignment.Left
    title.TextYAlignment = Enum.TextYAlignment.Center
    title.Parent = header

    local content = Instance.new("Frame")
    content.Name = "Content"
    content.Size = UDim2.new(1, 0, 1, -(isMobile and 50 or 40))
    content.Position = UDim2.new(0, 0, 0, isMobile and 50 or 40)
    content.BackgroundTransparency = 1
    content.Parent = mainFrame

    -- Header buttons
    local buttonContainer = Instance.new("Frame")
    buttonContainer.Name = "HeaderButtons"
    buttonContainer.Size = UDim2.new(0.3, 0, 1, 0)
    buttonContainer.Position = UDim2.new(0.7, 0, 0, 0)
    buttonContainer.BackgroundTransparency = 1
    buttonContainer.Parent = header

    local minimizeBtn = self:CreateHeaderButton(buttonContainer, "−", 0, function()
        self:ToggleMinimize(name)
    end)

    local closeBtn = self:CreateHeaderButton(buttonContainer, "×", 1, function()
        self:DestroyWindow(name)
    end)

    local windowTable = {
        Gui = screenGui,
        Main = mainFrame,
        Content = content,
        Header = header,
        Title = title,
        IsMobile = isMobile,
        IsMinimized = false,
        OriginalSize = baseSize
    }
    
    self.Windows[name] = windowTable
    return windowTable
end

function UILib:CreateHeaderButton(parent, text, index, onClick)
    local isMobile = self.IsMobile
    local buttonSize = isMobile and 30 or 25
    
    local button = Instance.new("TextButton")
    button.Name = "HeaderBtn_" .. text
    button.Size = UDim2.new(0, buttonSize, 0, buttonSize)
    button.Position = UDim2.new(index * 0.33, 5, 0.5, -buttonSize/2)
    button.BackgroundTransparency = 1
    button.Text = text
    button.TextColor3 = self.CurrentTheme.Text
    button.TextSize = isMobile and 18 or 16
    button.Font = Enum.Font.GothamBold
    button.Parent = parent

    button.MouseButton1Click:Connect(function()
        pcall(onClick)
    end)

    return button
end

function UILib:CreateSection(parent, title, height)
    local isMobile = self.IsMobile
    local padding = isMobile and CONFIG.MOBILE_PADDING or CONFIG.DESKTOP_PADDING
    
    local section = Instance.new("Frame")
    section.Name = "Section_" .. (title or "Untitled")
    section.Size = UDim2.new(1, -padding * 2, 0, height or (isMobile and 50 or 40))
    section.Position = UDim2.new(0, padding, 0, 0)
    section.BackgroundColor3 = self.CurrentTheme.Secondary
    section.BorderSizePixel = 0
    section.Parent = parent

    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, isMobile and 8 or 6)
    corner.Parent = section

    local label = Instance.new("TextLabel")
    label.Name = "Title"
    label.Size = UDim2.new(1, -padding * 2, 1, 0)
    label.Position = UDim2.new(0, padding, 0, 0)
    label.BackgroundTransparency = 1
    label.Text = title or "Section"
    label.TextColor3 = self.CurrentTheme.Text
    label.TextSize = isMobile and 18 or 16
    label.Font = Enum.Font.GothamSemibold
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.TextYAlignment = Enum.TextYAlignment.Center
    label.Parent = section

    return section
end

function UILib:CreateLabel(parent, text, textSize, options)
    options = options or {}
    local isMobile = self.IsMobile
    local padding = isMobile and CONFIG.MOBILE_PADDING or CONFIG.DESKTOP_PADDING
    
    local label = Instance.new("TextLabel")
    label.Name = "Label_" .. (text or "Untitled")
    label.Size = options.Size or UDim2.new(1, -padding * 2, 0, isMobile and 25 or 20)
    label.Position = options.Position or UDim2.new(0, padding, 0, 0)
    label.BackgroundTransparency = 1
    label.Text = text or "Label"
    label.TextColor3 = options.TextColor3 or self.CurrentTheme.Text
    label.TextSize = textSize or (isMobile and 16 or 14)
    label.Font = options.Font or Enum.Font.Gotham
    label.TextXAlignment = options.TextXAlignment or Enum.TextXAlignment.Left
    label.TextYAlignment = options.TextYAlignment or Enum.TextYAlignment.Center
    label.TextWrapped = options.TextWrapped or false
    label.Parent = parent

    return label
end

function UILib:CreateButton(parent, text, onClick, options)
    options = options or {}
    local isMobile = self.IsMobile
    local padding = isMobile and CONFIG.MOBILE_PADDING or CONFIG.DESKTOP_PADDING
    
    local button = Instance.new("TextButton")
    button.Name = "Button_" .. (text or "Untitled")
    button.Size = options.Size or UDim2.new(1, -padding * 2, 0, isMobile and 45 or 35)
    button.Position = options.Position or UDim2.new(0, padding, 0, 0)
    button.BackgroundColor3 = options.BackgroundColor3 or self.CurrentTheme.Accent
    button.BorderSizePixel = 0
    button.Text = text or "Button"
    button.TextColor3 = options.TextColor3 or Color3.new(1, 1, 1)
    button.TextSize = isMobile and 18 or 14
    button.Font = Enum.Font.GothamSemibold
    button.Parent = parent

    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, isMobile and 8 or 6)
    corner.Parent = button

    -- Hover effects (desktop only)
    if not isMobile then
        local originalColor = button.BackgroundColor3
        local hoverColor = self:LightenColor(originalColor, 0.2)
        
        button.MouseEnter:Connect(function()
            self:Tween(button, {BackgroundColor3 = hoverColor}, 0.2)
        end)
        
        button.MouseLeave:Connect(function()
            self:Tween(button, {BackgroundColor3 = originalColor}, 0.2)
        end)
    end

    -- Click effect
    button.MouseButton1Down:Connect(function()
        if isMobile then
            self:Tween(button, {BackgroundTransparency = 0.3}, 0.1)
        else
            self:Tween(button, {Size = button.Size - UDim2.new(0, 4, 0, 4)}, 0.1)
        end
    end)
    
    button.MouseButton1Up:Connect(function()
        if isMobile then
            self:Tween(button, {BackgroundTransparency = 0}, 0.1)
        else
            self:Tween(button, {Size = button.Size + UDim2.new(0, 4, 0, 4)}, 0.1)
        end
    end)

    button.MouseButton1Click:Connect(function()
        pcall(onClick)
    end)

    return button
end

function UILib:CreateTextBox(parent, placeholder, onChange, options)
    options = options or {}
    local isMobile = self.IsMobile
    local padding = isMobile and CONFIG.MOBILE_PADDING or CONFIG.DESKTOP_PADDING
    
    local textBox = Instance.new("TextBox")
    textBox.Name = "TextBox_" .. (placeholder or "Input")
    textBox.Size = options.Size or UDim2.new(1, -padding * 2, 0, isMobile and 45 or 35)
    textBox.Position = options.Position or UDim2.new(0, padding, 0, 0)
    textBox.BackgroundColor3 = self.CurrentTheme.Background
    textBox.BorderSizePixel = 0
    textBox.Text = options.Text or ""
    textBox.PlaceholderText = placeholder or "Type here..."
    textBox.TextColor3 = self.CurrentTheme.Text
    textBox.PlaceholderColor3 = self.CurrentTheme.SubText
    textBox.TextSize = isMobile and 16 or 14
    textBox.Font = Enum.Font.Gotham
    textBox.ClearTextOnFocus = options.ClearTextOnFocus or false
    textBox.Parent = parent

    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, isMobile and 6 or 4)
    corner.Parent = textBox

    local paddingEl = Instance.new("UIPadding")
    paddingEl.PaddingLeft = UDim.new(0, 10)
    paddingEl.PaddingRight = UDim.new(0, 10)
    paddingEl.Parent = textBox

    if onChange then
        textBox:GetPropertyChangedSignal("Text"):Connect(function()
            pcall(onChange, textBox.Text)
        end)
    end

    return textBox
end

function UILib:CreateScrollingFrame(parent, options)
    options = options or {}
    local isMobile = self.IsMobile
    
    local scroll = Instance.new("ScrollingFrame")
    scroll.Name = "ScrollFrame"
    scroll.Size = options.Size or UDim2.new(1, 0, 1, 0)
    scroll.Position = options.Position or UDim2.new(0, 0, 0, 0)
    scroll.BackgroundTransparency = 1
    scroll.BorderSizePixel = 0
    scroll.ScrollBarThickness = isMobile and 8 or 6
    scroll.ScrollBarImageColor3 = self.CurrentTheme.Accent
    scroll.ScrollingDirection = Enum.ScrollingDirection.Y
    scroll.VerticalScrollBarInset = Enum.ScrollBarInset.Always
    scroll.Parent = parent

    local listLayout = Instance.new("UIListLayout")
    listLayout.Name = "ListLayout"
    listLayout.Padding = UDim.new(0, options.Padding or (isMobile and 8 or 5))
    listLayout.SortOrder = Enum.SortOrder.LayoutOrder
    listLayout.Parent = scroll

    listLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
        scroll.CanvasSize = UDim2.new(0, 0, 0, listLayout.AbsoluteContentSize.Y)
    end)

    return scroll
end

function UILib:CreateToggle(parent, text, defaultValue, onChange)
    local isMobile = self.IsMobile
    local padding = isMobile and CONFIG.MOBILE_PADDING or CONFIG.DESKTOP_PADDING
    
    local container = Instance.new("Frame")
    container.Name = "Toggle_" .. (text or "Toggle")
    container.Size = UDim2.new(1, -padding * 2, 0, isMobile and 45 or 35)
    container.Position = UDim2.new(0, padding, 0, 0)
    container.BackgroundTransparency = 1
    container.Parent = parent

    local label = Instance.new("TextLabel")
    label.Name = "Label"
    label.Size = UDim2.new(0.7, 0, 1, 0)
    label.Position = UDim2.new(0, 0, 0, 0)
    label.BackgroundTransparency = 1
    label.Text = text or "Toggle"
    label.TextColor3 = self.CurrentTheme.Text
    label.TextSize = isMobile and 16 or 14
    label.Font = Enum.Font.Gotham
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.TextYAlignment = Enum.TextYAlignment.Center
    label.Parent = container

    local toggleFrame = Instance.new("Frame")
    toggleFrame.Name = "ToggleFrame"
    toggleFrame.Size = UDim2.new(0, isMobile and 60 or 50, 1, 0)
    toggleFrame.Position = UDim2.new(1, -(isMobile and 60 or 50), 0, 0)
    toggleFrame.BackgroundColor3 = self.CurrentTheme.Secondary
    toggleFrame.BorderSizePixel = 0
    toggleFrame.Parent = container

    local toggleCorner = Instance.new("UICorner")
    toggleCorner.CornerRadius = UDim.new(1, 0)
    toggleCorner.Parent = toggleFrame

    local toggleButton = Instance.new("Frame")
    toggleButton.Name = "ToggleButton"
    toggleButton.Size = UDim2.new(0, isMobile and 25 or 20, 0, isMobile and 25 or 20)
    toggleButton.Position = UDim2.new(0, isMobile and 3 or 2, 0.5, -(isMobile and 12.5 or 10))
    toggleButton.BackgroundColor3 = self.CurrentTheme.Text
    toggleButton.BorderSizePixel = 0
    toggleButton.Parent = toggleFrame

    local buttonCorner = Instance.new("UICorner")
    buttonCorner.CornerRadius = UDim.new(1, 0)
    buttonCorner.Parent = toggleButton

    local isToggled = defaultValue or false
    
    local function updateToggle()
        if isToggled then
            self:Tween(toggleButton, {
                Position = UDim2.new(1, -(isMobile and 28 or 22), 0.5, -(isMobile and 12.5 or 10)),
                BackgroundColor3 = self.CurrentTheme.Success
            }, 0.2)
            self:Tween(toggleFrame, {BackgroundColor3 = self.CurrentTheme.Success}, 0.2)
        else
            self:Tween(toggleButton, {
                Position = UDim2.new(0, isMobile and 3 or 2, 0.5, -(isMobile and 12.5 or 10)),
                BackgroundColor3 = self.CurrentTheme.Text
            }, 0.2)
            self:Tween(toggleFrame, {BackgroundColor3 = self.CurrentTheme.Secondary}, 0.2)
        end
    end

    local function toggle()
        isToggled = not isToggled
        updateToggle()
        if onChange then
            pcall(onChange, isToggled)
        end
    end

    local button = Instance.new("TextButton")
    button.Name = "ToggleButton"
    button.Size = UDim2.new(1, 0, 1, 0)
    button.BackgroundTransparency = 1
    button.Text = ""
    button.Parent = container

    button.MouseButton1Click:Connect(toggle)
    
    updateToggle()

    return {
        Container = container,
        SetValue = function(value)
            isToggled = value
            updateToggle()
        end,
        GetValue = function()
            return isToggled
        end
    }
end

function UILib:CreateSlider(parent, text, min, max, defaultValue, onChange)
    local isMobile = self.IsMobile
    local padding = isMobile and CONFIG.MOBILE_PADDING or CONFIG.DESKTOP_PADDING
    
    local container = Instance.new("Frame")
    container.Name = "Slider_" .. (text or "Slider")
    container.Size = UDim2.new(1, -padding * 2, 0, isMobile and 70 or 60)
    container.Position = UDim2.new(0, padding, 0, 0)
    container.BackgroundTransparency = 1
    container.Parent = parent

    local label = Instance.new("TextLabel")
    label.Name = "Label"
    label.Size = UDim2.new(1, 0, 0, isMobile and 25 or 20)
    label.Position = UDim2.new(0, 0, 0, 0)
    label.BackgroundTransparency = 1
    label.Text = text or "Slider"
    label.TextColor3 = self.CurrentTheme.Text
    label.TextSize = isMobile and 16 or 14
    label.Font = Enum.Font.Gotham
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Parent = container

    local valueLabel = Instance.new("TextLabel")
    valueLabel.Name = "Value"
    valueLabel.Size = UDim2.new(0, 60, 0, isMobile and 25 or 20)
    valueLabel.Position = UDim2.new(1, -60, 0, 0)
    valueLabel.BackgroundTransparency = 1
    valueLabel.Text = tostring(defaultValue or min)
    valueLabel.TextColor3 = self.CurrentTheme.SubText
    valueLabel.TextSize = isMobile and 16 or 14
    valueLabel.Font = Enum.Font.Gotham
    valueLabel.TextXAlignment = Enum.TextXAlignment.Right
    valueLabel.Parent = container

    local track = Instance.new("Frame")
    track.Name = "Track"
    track.Size = UDim2.new(1, 0, 0, isMobile and 8 or 6)
    track.Position = UDim2.new(0, 0, 1, -(isMobile and 20 or 15))
    track.BackgroundColor3 = self.CurrentTheme.Secondary
    track.BorderSizePixel = 0
    track.Parent = container

    local trackCorner = Instance.new("UICorner")
    trackCorner.CornerRadius = UDim.new(1, 0)
    trackCorner.Parent = track

    local fill = Instance.new("Frame")
    fill.Name = "Fill"
    fill.Size = UDim2.new(0, 0, 1, 0)
    fill.Position = UDim2.new(0, 0, 0, 0)
    fill.BackgroundColor3 = self.CurrentTheme.Accent
    fill.BorderSizePixel = 0
    fill.Parent = track

    local fillCorner = Instance.new("UICorner")
    fillCorner.CornerRadius = UDim.new(1, 0)
    fillCorner.Parent = fill

    local thumb = Instance.new("Frame")
    thumb.Name = "Thumb"
    thumb.Size = UDim2.new(0, isMobile and 20 or 16, 0, isMobile and 20 or 16)
    thumb.Position = UDim2.new(0, 0, 0.5, -(isMobile and 10 or 8))
    thumb.BackgroundColor3 = self.CurrentTheme.Text
    thumb.BorderSizePixel = 0
    thumb.Parent = track

    local thumbCorner = Instance.new("UICorner")
    thumbCorner.CornerRadius = UDim.new(1, 0)
    thumbCorner.Parent = thumb

    local currentValue = defaultValue or min
    local isDragging = false

    local function updateSlider(value)
        currentValue = math.clamp(value, min, max)
        local ratio = (currentValue - min) / (max - min)
        
        fill.Size = UDim2.new(ratio, 0, 1, 0)
        thumb.Position = UDim2.new(ratio, -(isMobile and 10 or 8), 0.5, -(isMobile and 10 or 8))
        valueLabel.Text = tostring(math.floor(currentValue))
        
        if onChange then
            pcall(onChange, currentValue)
        end
    end

    local function onInputChanged(input)
        if isDragging and input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
            local trackAbsolutePos = track.AbsolutePosition.X
            local trackAbsoluteSize = track.AbsoluteSize.X
            local thumbAbsoluteSize = thumb.AbsoluteSize.X
            
            local relativeX = (input.Position.X - trackAbsolutePos) / trackAbsoluteSize
            relativeX = math.clamp(relativeX, 0, 1)
            
            local value = min + (relativeX * (max - min))
            updateSlider(value)
        end
    end

    local function onInputBegan(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            isDragging = true
            self:Tween(thumb, {Size = UDim2.new(0, isMobile and 24 or 20, 0, isMobile and 24 or 20)}, 0.1)
        end
    end

    local function onInputEnded(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            isDragging = false
            self:Tween(thumb, {Size = UDim2.new(0, isMobile and 20 or 16, 0, isMobile and 20 or 16)}, 0.1)
        end
    end

    track.InputBegan:Connect(onInputBegan)
    track.InputChanged:Connect(onInputChanged)
    track.InputEnded:Connect(onInputEnded)
    
    thumb.InputBegan:Connect(onInputBegan)
    thumb.InputChanged:Connect(onInputChanged)
    thumb.InputEnded:Connect(onInputEnded)

    updateSlider(currentValue)

    return {
        Container = container,
        SetValue = updateSlider,
        GetValue = function()
            return currentValue
        end
    }
end

function UILib:CreateList(parent, items, onItemSelected, options)
    options = options or {}
    local isMobile = self.IsMobile
    
    local scroll = self:CreateScrollingFrame(parent, {
        Size = options.Size or UDim2.new(1, 0, 1, 0),
        Position = options.Position or UDim2.new(0, 0, 0, 0),
        Padding = isMobile and 8 or 5
    })

    local listItems = {}

    local function updateList(newItems)
        scroll:ClearAllChildren()
        listItems = {}
        
        for i, item in ipairs(newItems) do
            local padding = isMobile and CONFIG.MOBILE_PADDING or CONFIG.DESKTOP_PADDING
            
            local itemFrame = Instance.new("Frame")
            itemFrame.Name = "ListItem_" .. i
            itemFrame.Size = UDim2.new(1, -padding * 2, 0, isMobile and 50 or 40)
            itemFrame.Position = UDim2.new(0, padding, 0, 0)
            itemFrame.BackgroundColor3 = self.CurrentTheme.Secondary
            itemFrame.BorderSizePixel = 0
            itemFrame.LayoutOrder = i
            itemFrame.Parent = scroll

            local corner = Instance.new("UICorner")
            corner.CornerRadius = UDim.new(0, isMobile and 8 or 6)
            corner.Parent = itemFrame

            local label = Instance.new("TextLabel")
            label.Name = "Label"
            label.Size = UDim2.new(1, -20, 1, 0)
            label.Position = UDim2.new(0, 10, 0, 0)
            label.BackgroundTransparency = 1
            label.Text = tostring(item)
            label.TextColor3 = self.CurrentTheme.Text
            label.TextSize = isMobile and 16 or 14
            label.Font = Enum.Font.Gotham
            label.TextXAlignment = Enum.TextXAlignment.Left
            label.TextYAlignment = Enum.TextYAlignment.Center
            label.Parent = itemFrame

            local button = Instance.new("TextButton")
            button.Name = "SelectButton"
            button.Size = UDim2.new(1, 0, 1, 0)
            button.BackgroundTransparency = 1
            button.BorderSizePixel = 0
            button.Text = ""
            button.Parent = itemFrame

            button.MouseButton1Click:Connect(function()
                if onItemSelected then
                    pcall(onItemSelected, item, i)
                end
            end)

            table.insert(listItems, {
                Frame = itemFrame,
                Label = label,
                Data = item
            })
        end
    end

    updateList(items)

    return {
        ScrollFrame = scroll,
        UpdateItems = updateList,
        GetItems = function()
            return listItems
        end
    }
end

function UILib:CreateMobileFAB(icon, onClick, options)
    if not self.IsMobile then return nil end
    
    options = options or {}
    
    local fab = Instance.new("TextButton")
    fab.Name = "FAB"
    fab.Size = UDim2.new(0, 70, 0, 70)
    fab.Position = options.Position or UDim2.new(1, -90, 1, -90)
    fab.BackgroundColor3 = options.BackgroundColor3 or self.CurrentTheme.Accent
    fab.Text = icon or "➕"
    fab.TextColor3 = Color3.new(1, 1, 1)
    fab.TextSize = 24
    fab.Font = Enum.Font.GothamBold
    fab.ZIndex = 1000
    fab.Parent = options.Parent or self:CreateScreenGui("FABGui")

    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(1, 0)
    corner.Parent = fab

    local dropShadow = Instance.new("ImageLabel")
    dropShadow.Name = "DropShadow"
    dropShadow.Size = UDim2.new(1, 20, 1, 20)
    dropShadow.Position = UDim2.new(0, -10, 0, -10)
    dropShadow.BackgroundTransparency = 1
    dropShadow.Image = "rbxassetid://6014261993"
    dropShadow.ImageColor3 = Color3.new(0, 0, 0)
    dropShadow.ImageTransparency = 0.8
    dropShadow.ScaleType = Enum.ScaleType.Slice
    dropShadow.SliceCenter = Rect.new(49, 49, 450, 450)
    dropShadow.Parent = fab

    fab.MouseButton1Click:Connect(function()
        pcall(onClick)
    end)

    return fab
end

function UILib:CreateNotification(message, duration, type)
    duration = duration or 5
    type = type or "Info"
    
    local isMobile = self.IsMobile
    local screenGui = self:CreateScreenGui("NotificationGui")
    
    local notification = Instance.new("Frame")
    notification.Name = "Notification"
    notification.Size = UDim2.new(0, isMobile and 300 or 350, 0, isMobile and 80 or 60)
    notification.Position = UDim2.new(1, -(isMobile and 320 or 370), 1, -100)
    notification.BackgroundColor3 = self.CurrentTheme.Secondary
    notification.BorderSizePixel = 0
    notification.Parent = screenGui

    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, isMobile and 12 or 8)
    corner.Parent = notification

    local dropShadow = Instance.new("ImageLabel")
    dropShadow.Name = "DropShadow"
    dropShadow.Size = UDim2.new(1, 12, 1, 12)
    dropShadow.Position = UDim2.new(0, -6, 0, -6)
    dropShadow.BackgroundTransparency = 1
    dropShadow.Image = "rbxassetid://6014261993"
    dropShadow.ImageColor3 = Color3.new(0, 0, 0)
    dropShadow.ImageTransparency = 0.8
    dropShadow.ScaleType = Enum.ScaleType.Slice
    dropShadow.SliceCenter = Rect.new(49, 49, 450, 450)
    dropShadow.Parent = notification

    local icon = Instance.new("TextLabel")
    icon.Name = "Icon"
    icon.Size = UDim2.new(0, 40, 1, 0)
    icon.Position = UDim2.new(0, 0, 0, 0)
    icon.BackgroundTransparency = 1
    icon.Text = type == "Success" and "✓" or type == "Warning" and "⚠" or type == "Error" and "✕" or "ℹ"
    icon.TextColor3 = type == "Success" and self.CurrentTheme.Success or 
                     type == "Warning" and self.CurrentTheme.Warning or 
                     type == "Error" and self.CurrentTheme.Error or 
                     self.CurrentTheme.Accent
    icon.TextSize = isMobile and 20 or 18
    icon.Font = Enum.Font.GothamBold
    icon.TextYAlignment = Enum.TextYAlignment.Center
    icon.Parent = notification

    local messageLabel = Instance.new("TextLabel")
    messageLabel.Name = "Message"
    messageLabel.Size = UDim2.new(1, -50, 1, -20)
    messageLabel.Position = UDim2.new(0, 40, 0, 10)
    messageLabel.BackgroundTransparency = 1
    messageLabel.Text = message
    messageLabel.TextColor3 = self.CurrentTheme.Text
    messageLabel.TextSize = isMobile and 16 or 14
    messageLabel.Font = Enum.Font.Gotham
    messageLabel.TextWrapped = true
    messageLabel.TextXAlignment = Enum.TextXAlignment.Left
    messageLabel.TextYAlignment = Enum.TextYAlignment.Top
    messageLabel.Parent = notification

    -- Animate in
    self:Tween(notification, {Position = UDim2.new(1, -(isMobile and 320 or 370), 1, -(isMobile and 90 or 70))}, 0.3)

    -- Auto remove
    delay(duration, function()
        self:Tween(notification, {Position = UDim2.new(1, -(isMobile and 320 or 370), 1, -100)}, 0.3)
        wait(0.3)
        notification:Destroy()
    end)

    return notification
end

-- Utility Functions
function UILib:Tween(element, properties, duration)
    local tweenInfo = TweenInfo.new(duration or CONFIG.TWEEN_DURATION, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
    local tween = TweenService:Create(element, tweenInfo, properties)
    tween:Play()
    return tween
end

function UILib:LightenColor(color, amount)
    amount = amount or 0.2
    return Color3.new(
        math.min(color.R + amount, 1),
        math.min(color.G + amount, 1),
        math.min(color.B + amount, 1)
    )
end

function UILib:DarkenColor(color, amount)
    amount = amount or 0.2
    return Color3.new(
        math.max(color.R - amount, 0),
        math.max(color.G - amount, 0),
        math.max(color.B - amount, 0)
    )
end

function UILib:SetTheme(themeName)
    self.CurrentTheme = self.Themes[themeName] or self.Themes.Dark
end

function UILib:DestroyWindow(windowName)
    if self.Windows[windowName] then
        self.Windows[windowName].Gui:Destroy()
        self.Windows[windowName] = nil
    end
end

function UILib:ToggleMinimize(windowName)
    local window = self.Windows[windowName]
    if window then
        if window.IsMinimized then
            window.IsMinimized = false
            self:Tween(window.Main, {Size = window.OriginalSize}, 0.3)
        else
            window.IsMinimized = true
            self:Tween(window.Main, {
                Size = UDim2.new(window.Main.Size.X.Scale, window.Main.Size.X.Offset, 0, window.Header.Size.Y.Offset)
            }, 0.3)
        end
    end
end

function UILib:SetWindowVisibility(windowName, visible)
    local window = self.Windows[windowName]
    if window then
        window.Gui.Enabled = visible
    end
end

function UILib:GetWindow(windowName)
    return self.Windows[windowName]
end

-- Mobile-specific utilities
function UILib:CreateMobileNavBar(parent, tabs, onTabSelected)
    if not self.IsMobile then return nil end
    
    local navBar = Instance.new("Frame")
    navBar.Name = "NavBar"
    navBar.Size = UDim2.new(1, 0, 0, 60)
    navBar.Position = UDim2.new(0, 0, 1, -60)
    navBar.BackgroundColor3 = self.CurrentTheme.Secondary
    navBar.BorderSizePixel = 0
    navBar.Parent = parent

    local layout = Instance.new("UIListLayout")
    layout.Name = "Layout"
    layout.FillDirection = Enum.FillDirection.Horizontal
    layout.HorizontalAlignment = Enum.HorizontalAlignment.Center
    layout.VerticalAlignment = Enum.VerticalAlignment.Center
    layout.SortOrder = Enum.SortOrder.LayoutOrder
    layout.Parent = navBar

    for i, tab in ipairs(tabs) do
        local tabButton = Instance.new("TextButton")
        tabButton.Name = tab .. "Tab"
        tabButton.Size = UDim2.new(1 / #tabs, 0, 1, 0)
        tabButton.BackgroundTransparency = 1
        tabButton.Text = tab
        tabButton.TextColor3 = self.CurrentTheme.Text
        tabButton.TextSize = 14
        tabButton.Font = Enum.Font.Gotham
        tabButton.LayoutOrder = i
        tabButton.Parent = navBar

        tabButton.MouseButton1Click:Connect(function()
            if onTabSelected then
                pcall(onTabSelected, tab, i)
            end
        end)
    end

    return navBar
end

-- Export the library
return UILib
