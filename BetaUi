local BetaUILib = {}
BetaUILib.__index = BetaUILib

-- Helper function to create new instances
function BetaUILib.new()
    local self = setmetatable({}, BetaUILib)
    self.UIElements = {}
    return self
end

-- Function to create a window
function BetaUILib:MakeWindow(config)
    local window = Instance.new("ScreenGui")
    window.Name = config.Name or "BetaWindow"
    window.DisplayOrder = 1
    window.ResetOnSpawn = false
    window.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")

    -- Window background
    local frame = Instance.new("Frame")
    frame.Parent = window
    frame.Size = UDim2.new(0, 400, 0, 300)  -- Default size (can be customized)
    frame.Position = UDim2.new(0.5, -200, 0.5, -150)  -- Centered on the screen
    frame.BackgroundColor3 = Color3.fromRGB(34, 34, 34)
    frame.BorderSizePixel = 0
    frame.ClipsDescendants = true
    frame.Name = "MainFrame"

    -- Corner radius for rounded edges
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 15)  -- Rounded corners
    corner.Parent = frame

    -- Title bar for the window (with Minimize and Close buttons)
    local titleBar = Instance.new("Frame")
    titleBar.Parent = frame
    titleBar.Size = UDim2.new(1, 0, 0, 30)
    titleBar.BackgroundColor3 = Color3.fromRGB(58, 58, 58)
    titleBar.BorderSizePixel = 0
    titleBar.Name = "TitleBar"

    -- Close Button (X)
    local closeButton = Instance.new("TextButton")
    closeButton.Parent = titleBar
    closeButton.Size = UDim2.new(0, 40, 0, 30)
    closeButton.Position = UDim2.new(1, -40, 0, 0)
    closeButton.BackgroundColor3 = Color3.fromRGB(255, 50, 50)
    closeButton.Text = "X"
    closeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    closeButton.TextSize = 18
    closeButton.BorderSizePixel = 0
    closeButton.Name = "CloseButton"

    closeButton.MouseButton1Click:Connect(function()
        window:Destroy()
    end)

    -- Minimize Button
    local minimizeButton = Instance.new("TextButton")
    minimizeButton.Parent = titleBar
    minimizeButton.Size = UDim2.new(0, 40, 0, 30)
    minimizeButton.Position = UDim2.new(1, -80, 0, 0)
    minimizeButton.BackgroundColor3 = Color3.fromRGB(50, 50, 255)
    minimizeButton.Text = "-"
    minimizeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    minimizeButton.TextSize = 18
    minimizeButton.BorderSizePixel = 0
    minimizeButton.Name = "MinimizeButton"

    minimizeButton.MouseButton1Click:Connect(function()
        frame.Visible = not frame.Visible
    end)

    -- Title Label
    local titleLabel = Instance.new("TextLabel")
    titleLabel.Parent = titleBar
    titleLabel.Size = UDim2.new(1, -80, 1, 0)
    titleLabel.BackgroundTransparency = 1
    titleLabel.Text = config.Name or "Window Title"
    titleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    titleLabel.TextSize = 20
    titleLabel.TextXAlignment = Enum.TextXAlignment.Left
    titleLabel.TextYAlignment = Enum.TextYAlignment.Center
    titleLabel.PaddingLeft = 10

    -- Draggable functionality
    local dragging = false
    local dragInput, dragStart, startPos

    titleBar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = frame.Position
        end
    end)

    titleBar.InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local delta = input.Position - dragStart
            frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end
    end)

    titleBar.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
        end
    end)

    -- Add to the UI elements table
    table.insert(self.UIElements, window)
    
    return window
end

-- Function to create tabs
function BetaUILib:MakeTab(config)
    local tab = Instance.new("Frame")
    tab.Parent = config.Parent
    tab.Size = UDim2.new(0, 380, 0, 260)
    tab.Position = UDim2.new(0, 10, 0, 40)
    tab.BackgroundColor3 = Color3.fromRGB(44, 44, 44)
    tab.BorderSizePixel = 0
    tab.Name = "Tab"

    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 10)
    corner.Parent = tab

    local tabTitle = Instance.new("TextLabel")
    tabTitle.Parent = tab
    tabTitle.Size = UDim2.new(1, 0, 0, 30)
    tabTitle.BackgroundTransparency = 1
    tabTitle.Text = config.Name or "Tab"
    tabTitle.TextColor3 = Color3.fromRGB(255, 255, 255)
    tabTitle.TextSize = 20
    tabTitle.TextXAlignment = Enum.TextXAlignment.Left
    tabTitle.TextYAlignment = Enum.TextYAlignment.Center
    tabTitle.PaddingLeft = 10

    -- Placeholder for tab content
    local contentFrame = Instance.new("Frame")
    contentFrame.Parent = tab
    contentFrame.Size = UDim2.new(1, 0, 1, -40)
    contentFrame.Position = UDim2.new(0, 0, 0, 30)
    contentFrame.BackgroundTransparency = 1
    contentFrame.Name = "ContentFrame"

    -- Add to UI elements
    table.insert(self.UIElements, tab)

    return contentFrame
end

-- Function to add buttons to the UI
function BetaUILib:AddButton(config)
    local button = Instance.new("TextButton")
    button.Parent = config.Parent
    button.Size = UDim2.new(0, 150, 0, 40)
    button.Position = UDim2.new(0.5, -75, 0, 10)
    button.BackgroundColor3 = Color3.fromRGB(64, 64, 64)
    button.TextColor3 = Color3.fromRGB(255, 255, 255)
    button.TextSize = 18
    button.Text = config.Name
    button.BorderSizePixel = 0
    button.Name = "Button"
    button.TextButtonStyle = Enum.ButtonStyle.RobloxButton

    -- Button click event
    button.MouseButton1Click:Connect(function()
        config.Callback()
    end)

    -- Return the button so it can be modified
    return button
end

-- Function to add a toggle
function BetaUILib:AddToggle(config)
    local toggle = Instance.new("TextButton")
    toggle.Parent = config.Parent
    toggle.Size = UDim2.new(0, 150, 0, 40)
    toggle.Position = UDim2.new(0.5, -75, 0, 10)
    toggle.BackgroundColor3 = Color3.fromRGB(64, 64, 64)
    toggle.TextColor3 = Color3.fromRGB(255, 255, 255)
    toggle.TextSize = 18
    toggle.Text = config.Name
    toggle.BorderSizePixel = 0
    toggle.Name = "Toggle"
    
    local isToggled = config.Default

    toggle.MouseButton1Click:Connect(function()
        isToggled = not isToggled
        config.Callback(isToggled)
        toggle.BackgroundColor3 = isToggled and Color3.fromRGB(50, 255, 50) or Color3.fromRGB(255, 50, 50)
    end)

    return toggle
end

-- Function to initialize the library (called after everything is set up)
function BetaUILib:Init()
    for _, element in pairs(self.UIElements) do
        element.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")
    end
end

-- Function to destroy the library and its elements
function BetaUILib:Destroy()
    for _, element in pairs(self.UIElements) do
        element:Destroy()
    end
end

return BetaUILib
